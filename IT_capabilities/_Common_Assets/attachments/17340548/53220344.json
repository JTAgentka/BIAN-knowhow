{
  "title": "CollAccountTransaction",
  "$schema": "http://json-schema.org/draft-04/schema#",
  "description": "Collection account transcation schema",
  "type": "object",
  "required": [
    "transactionIds",
    "businessChangeDate",
    "collAccountIds",
    "portfolioIds",
    "accCurrency",
    "transactionCategory",
    "amountAccCurrency",
    "isBlocking",
    "isTraded",
    "isSettled",
    "status"
  ],
  "properties": {
    "X-Correlation-ID": {
      "type": [
        "string",
        "null"
      ],
      "title": "X-Correlation-ID",
      "description": "Korelační identifikátor, povinné pro INIT a RECON"
    },
    "transactionIds": {
      "type": "object",
      "description": "IDs transakce",
      "$ref": "#/definitions/transactionIds"
    },
    "businessChangeDate": {
      "description": "Datum a čas poslední změny entity",
      "type": "string",
      "format": "date-time"
    },
    "collAccountIds": {
      "type": "object",
      "description": "IDs sběrného účtu",
      "$ref": "#/definitions/collAccountIds"
    },
    "tradeIds": {
      "type": "object",
      "description": "IDs obchodu",
      "$ref": "#/definitions/tradeIds"
    },
    "orderIds": {
      "type": "object",
      "description": "Identifikátory pokynu",
      "$ref": "#/definitions/orderIds"
    },
    "instrumentIds": {
      "type": "object",
      "description": "Identifikace CP",
      "$ref": "#/definitions/instrumentIds"
    },
    "portfolioIds": {
      "type": "object",
      "description": "Identifkátory portfolia",
      "$ref": "#/definitions/portfolioIds"
    },
    "accCurrency": {
      "description": "Měna pohybu peněz",
      "type": "string"
    },
    "transactionCategory": {
      "description": "Kategorie pohybu peněz. Hodnoty tech jsou technické převody mezi TOPAS a TA, klientovi nezobrazovat.",
      "type": "string",
      "enum": [
        "vkl_vyb",
        "obchod",
        "poplatek",
        "urok",
        "dividenda",
        "tech"
      ]
    },
    "transactionTypeId": {
      "type": [
        "string",
        "null"
      ],
      "description": "Kód typu platby"
    },
    "transactionDescriptions": {
      "type": [
        "array",
        "null"
      ],
      "description": "Kolekce jazykových mutací popisu transakce",
      "items": {
        "type": "object",
        "required": [
          "language",
          "text"
        ],
        "properties": {
          "language": {
            "type": "string",
            "enum": [
              "CS",
              "EN",
              "SK"
            ],
            "description": "Jazyk popisu transakce"
          },
          "text": {
            "type": "string",
            "description": "Popis transakce"
          }
        }
      }
    },
    "amountAccCurrency": {
      "description": "Objem transakce v měně účtu",
      "type": "number"
    },
    "accCounterparty": {
      "description": "Účet protistrany. Zdroj pro TOPAS: Platby.IBAN, pokud neexistuje tak Platby.Ucet. Zdroj pro TA: ACCB_Payment.CounterpartBAIBAN",
      "type": [
        "string",
        "null"
      ]
    },
    "symbols": {
      "type": "object",
      "description": "Symboly",
      "properties": {
        "variableSymbol": {
          "type": [
            "string",
            "null"
          ],
          "description": "Variabilní symbol platby"
        },
        "constantSymbol": {
          "type": [
            "string",
            "null"
          ],
          "description": "Konstantní symbol platby"
        },
        "specificSymbol": {
          "type": [
            "string",
            "null"
          ],
          "description": "Specifický symbol platby"
        }
      }
    },
    "blockingDate": {
      "description": "Datum a čas blokace v TA",
      "type": [
        "string",
        "null"
      ],
      "format": "date-time"
    },
    "isBlocking": {
      "type": "boolean",
      "description": "Příznak blokace prostředků v TA. Suma blokovaných prostředků vychází z isBlocking=true and isTraded=false"
    },
    "tradeDate": {
      "description": "Datum a čas zobchodování. Pokud isTraded=false, tak má význam předpokládaného zobchodování",
      "type": [
        "string",
        "null"
      ],
      "format": "date-time"
    },
    "isTraded": {
      "type": "boolean",
      "description": "Příznak zobchodování"
    },
    "settlementInstructionDate": {
      "description": "Datum a čas exportu platby z TOPAS, slouží pro výpočet předvypořádaného (presettled) stavu.",
      "type": [
        "string",
        "null"
      ],
      "format": "date-time"
    },
    "settlementDate": {
      "description": "Datum a čas vypořádání. Pokud isSettled=false, tak má význam předpokládaného vypořádání",
      "type": [
        "string",
        "null"
      ],
      "format": "date-time"
    },
    "isSettled": {
      "type": "boolean",
      "description": "Příznak vypořádání"
    },
    "status": {
      "description": "Stav businessové platnosti entity: active - aktivní, deleted - info o zrušeném záznamu",
      "type": "string",
      "enum": [
        "active",
        "deleted"
      ]
    }
  },
  "definitions": {
    "transactionIds": {
      "description": "IDs transakce",
      "type": "object",
      "required": [
        "ebrokerId"
      ],
      "properties": {
        "ebrokerId": {
          "type": "integer",
          "description": "ID pohybu peněz v eBroker"
        },
        "topasId": {
          "type": [
            "integer",
            "null"
          ],
          "description": "ID platby v Topas"
        },
        "taId": {
          "type": [
            "integer",
            "null"
          ],
          "description": "ID platby v TA"
        }
      }
    },
    "tradeIds": {
      "description": "IDs obchodu",
      "type": "object",
      "properties": {
        "ebrokerId": {
          "type": [
            "integer",
            "null"
          ],
          "description": "ID obchodu v eBroker. Nepovinné, ne všechny platby mají vazbu na obchod (vklady, DFP)"
        },
        "topasIdNumber": {
          "type": [
            "integer",
            "null"
          ],
          "description": "ID čísla výsledku v Topas. Může být vyplněné i když je ebrokerId prázdné pro platby vázané k Výsledku, který není obchodem s CP (FXy, dividendy...)"
        },
        "topasIdSeq": {
          "type": [
            "integer",
            "null"
          ],
          "description": "ID pořadí Výsledku v Topas"
        },
        "taId": {
          "type": [
            "integer",
            "null"
          ],
          "description": "ID Transakce v TA"
        }
      }
    },
    "orderIds": {
      "description": "Identifikátory pokynu",
      "type": "object",
      "properties": {
        "ebrokerId": {
          "type": [
            "integer",
            "null"
          ],
          "description": "Identifikace Pokynu v eBroker"
        },
        "topasId": {
          "type": [
            "integer",
            "null"
          ],
          "description": "Identifikace Pokynu v Topas"
        },
        "taId": {
          "type": [
            "integer",
            "null"
          ],
          "description": "Identifikace Operace v TA"
        }
      }
    },
    "instrumentIds": {
      "description": "Identifikace CP",
      "type": "object",
      "required": [
        "ccpId",
        "ebrokerId"
      ],
      "properties": {
        "ccpId": {
          "type": "integer",
          "description": "Identifikace CP v CCP"
        },
        "ebrokerId": {
          "type": "integer",
          "description": "Identifikace CP v eBroker"
        },
        "topasId": {
          "type": [
            "integer",
            "null"
          ],
          "description": "Identifikace CP v TOPAS"
        },
        "taId": {
          "type": [
            "integer",
            "null"
          ],
          "description": "Identifikace Finančního instrumentu v TA"
        }
      }
    },
    "collAccountIds": {
      "description": "IDs sběrného účtu",
      "type": "object",
      "required": [
        "ebrokerId",
        "topasId",
        "taId",
        "accountNumber",
        "bankCode",
        "iban"
      ],
      "properties": {
        "ebrokerId": {
          "type": "integer",
          "description": "ID sběrného účtu v eBroker"
        },
        "topasId": {
          "type": "integer",
          "description": "ID sběrného účtu v Topas"
        },
        "taId": {
          "type": "integer",
          "description": "ID sběrného účtu v TA, v eBroker odkaz na Platební místo"
        },
        "accountNumberPrefix": {
          "description": "Předčíslí SÚ dle BBAN formátu",
          "type": [
            "string",
            "null"
          ],
          "maxLength": 6
        },
        "accountNumber": {
          "description": "Hlavní část SÚ dle BBAN formátu",
          "type": "string",
          "maxLength": 10
        },
        "bankCode": {
          "description": "Kód banky SÚ dle BBAN formátu",
          "type": "string",
          "maxLength": 4
        },
        "iban": {
          "type": "string",
          "maxlength": 34,
          "description": "SÚ v IBAN formátu"
        }
      }
    },
    "portfolioIds": {
      "description": "Identifkátory portfolia",
      "type": "object",
      "required": [
        "ebrokerId",
        "topasId"
      ],
      "properties": {
        "ebrokerId": {
          "type": "integer",
          "description": "Identifikace portfolia v eBroker"
        },
        "topasId": {
          "type": "integer",
          "description": "Identifikace Portfolia v TOPAS (KID)"
        },
        "taId": {
          "type": [
            "integer",
            "null"
          ],
          "description": "Identifikace Účtu podílníka v TA"
        }
      }
    },
    "person": {
      "description": "Person details",
      "type": "object",
      "required": [
        "crmId"
      ],
      "properties": {
        "crmId": {
          "type": "string",
          "description": "Unique CRM identifier",
          "minLength": 10,
          "maxLength": 10
        }
      }
    },
    "accBalancesAccCurrency": {
      "description": "Kolekce zůstatky na sběrném účtu v měně účtu",
      "type": "object",
      "required": [
        "blocked",
        "unsettled",
        "presettled",
        "settled"
      ],
      "properties": {
        "blocked": {
          "type": "number",
          "description": "Blokované (rezervované) prostředky v TA v měně SÚ. Blokované peníze se počítají jako suma Pohybů peněz, které mají nastaveno Je_Blokace, ale buď nemají nastaveno Je_Zobchodovan, nebo mají Datum zobchodování až po datu, ke kterému zobrazujeme stav portfolia"
        },
        "unsettled": {
          "type": "number",
          "description": "Zobchodovaný zůstatek na účtu v měně sběrného účtu"
        },
        "presettled": {
          "type": "number",
          "description": "Předvypořádaný (vypořádaný plus platební příkazy) zůstatek na účtech portfolia v měně sběrného účtu"
        },
        "settled": {
          "type": "number",
          "description": "Vypořádaný zůstatek na účtu v měně sběrného účtu"
        }
      }
    }
  }
}