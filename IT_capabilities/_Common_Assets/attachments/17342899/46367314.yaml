# 2022-01-12 – 1.0 - Pavel Hrdlička - added ENUM value "DICT" to parameter "ServiceLevel"
openapi: 3.0.3
info:
  title: PTSDKPay
  version: '1.0'
  description: API pro validaci, vytvoření, smazaní a zjištění stavu platby v PTS
paths:
  /validate:
    post:
      summary: Validace platby
      description: Vrací výsledek validace platby
      parameters:
        - $ref: '#/components/parameters/XCorrelationIDParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentRequest'
      responses:
        '200':
          $ref: '#/components/responses/ValidateOK'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /payment:
    post:
      summary: Založení platby
      description: Vrací výsledek založení platby
      parameters:
        - $ref: '#/components/parameters/XCorrelationIDParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentRequest'
      responses:
        '200':
          $ref: '#/components/responses/PaymentOK'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /payment/{ptsId}:
    parameters:
      - $ref: '#/components/parameters/PTSIDParam'
      - $ref: '#/components/parameters/XCorrelationIDParam'
    get:
      summary: Stav platby
      description: Vrací stav platby
      responses:
        '200':
          $ref: '#/components/responses/PaymentStatusOK'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Zrušení platby
      description: Zruší platbu v PTS
      responses:
        '204':
          $ref: '#/components/responses/NoContent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  headers:
    X-Correlation-ID:
      description: X-Correlation-ID
      required: true
      schema:
        type: string
  parameters:
    XCorrelationIDParam:
      name: X-Correlation-ID
      in: header
      description: X-Correlation-ID
      required: true
      schema:
        type: string
    PTSIDParam:
      name: ptsId
      in: path
      description: id platby
      required: true
      schema:
        $ref: '#/components/schemas/PTSId'
  schemas:
    BadRequestErrorModel:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: integer
              description: RFC 7231 - code
              enum:
                - 400
            message:
              type: string
              description: RFC 7231 - mesage or J&T extension code; J&T mesage
              enum:
                - 9903; Missing or invalid element
            timestamp:
              $ref: '#/components/schemas/ErrorTimestamp'
            index:
              $ref: '#/components/schemas/ErrorIndex'
            internal:
              type: object
              properties:
                code:
                  $ref: '#/components/schemas/BadRequestPTSCode'
                message:
                  type: string
                  description: message + scope
                  minLength: 1
              required:
                - code
                - message
          required:
            - code
            - message
            - timestamp
            - index
            - internal
      required:
        - error
    ForbiddenErrorModel:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: integer
              description: RFC 7231 - code
              enum:
                - 403
            message:
              type: string
              description: RFC 7231 - mesage or J&T extension code; J&T mesage
              enum:
                - Forbidden
            timestamp:
              $ref: '#/components/schemas/ErrorTimestamp'
            index:
              $ref: '#/components/schemas/ErrorIndex'
            internal:
              $ref: '#/components/schemas/BusinessInternal'
          required:
            - code
            - message
            - timestamp
            - index
            - internal
      required:
        - error
    NotFoundErrorModel:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: integer
              description: RFC 7231 - code
              enum:
                - 404
            message:
              type: string
              description: RFC 7231 - mesage or J&T extension code; J&T mesage
              enum:
                - Not Found
            timestamp:
              $ref: '#/components/schemas/ErrorTimestamp'
            index:
              $ref: '#/components/schemas/ErrorIndex'
            internal:
              $ref: '#/components/schemas/BusinessInternal'
          required:
            - code
            - message
            - timestamp
            - index
            - internal
      required:
        - error
    ConflictErrorModel:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: integer
              description: RFC 7231 - code
              enum:
                - 409
            message:
              type: string
              description: RFC 7231 - mesage or J&T extension code; J&T mesage
              enum:
                - Conflict
            timestamp:
              $ref: '#/components/schemas/ErrorTimestamp'
            index:
              $ref: '#/components/schemas/ErrorIndex'
            internal:
              $ref: '#/components/schemas/BusinessInternal'
          required:
            - code
            - message
            - timestamp
            - index
            - internal
      required:
        - error
    InternalServerErrorModel:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: integer
              description: RFC 7231 - code
              enum:
                - 500
            message:
              type: string
              description: RFC 7231 - mesage or J&T extension code; J&T mesage
              enum:
                - Internal Server Error
            timestamp:
              $ref: '#/components/schemas/ErrorTimestamp'
            index:
              $ref: '#/components/schemas/ErrorIndex'
            internal:
              type: object
              properties:
                code:
                  $ref: '#/components/schemas/InternalServerErrorPTSCode'
                message:
                  type: string
                  description: message
                  minLength: 1
              required:
                - code
                - message
          required:
            - code
            - message
            - timestamp
            - index
            - internal
      required:
        - error
    ErrorTimestamp:
      type: string
      format: date-time
      description: ''
    ErrorIndex:
      type: string
      description: X-corelation-ID
    BadRequestPTSCode:
      type: string
      description: Textový kód chyby
      enum:
        - SYNTAX_ERROR
        - FIELD_MISSING
        - FIELD_INVALID
    InternalServerErrorPTSCode:
      type: string
      description: Textový kód chyby
      enum:
        - SQL_ERROR
        - FATAL_ERROR
    BusinessInternal:
      type: object
      properties:
        code:
          type: string
          description: Textový kód chyby
          enum:
            - BUSINESS_ERROR
        message:
          type: string
          description: message + scope
          minLength: 1
      required:
        - code
        - message
    PaymentRequest:
      type: object
      properties:
        operationId:
          $ref: '#/components/schemas/OperationId'
        sourceChannel:
          type: string
          description: Zdroj platby- kod aplikace/rozhraní, která/é zakládá platbu
          pattern: '[A-Z0-9]{2,3}'
        paymentIdentification:
          $ref: '#/components/schemas/PaymentIdentification'
        paymentTypeInformation:
          type: object
          properties:
            instructionPriority:
              type: string
              description: Priorita platby
              enum:
                - INST
                - NORM
                - HIGH
        amount:
          type: object
          description: Částka a měna platby
          properties:
            instructedAmount:
              $ref: '#/components/schemas/ValueAndCurrency'
          required:
            - instructedAmount
        requestedExecutionDate:
          type: string
          description: Datum splatnosti
          format: date
        chargeBearer:
          type: string
          description: Kód poplatku
          enum:
            - CRED
            - DEBT
            - SHAR
            - SLEV
        ultimateDebtor:
          $ref: '#/components/schemas/UltimateElement'
        debtorAccount:
          $ref: '#/components/schemas/AccountElement'
        creditorAgent:
          $ref: '#/components/schemas/CreditorAgent'
        creditor:
          $ref: '#/components/schemas/NameAndAddress'
        creditorAccount:
          $ref: '#/components/schemas/AccountElement'
        ultimateCreditor:
          $ref: '#/components/schemas/UltimateElement'
        purpose:
          oneOf:
            - type: object
              properties:
                code:
                  $ref: '#/components/schemas/Max4Text'
            - type: object
              properties:
                proprietary:
                  $ref: '#/components/schemas/Max35Text'
        remittanceInformation:
          type: object
          description: ''
          properties:
            structured:
              type: object
              properties:
                creditorReferenceInformation:
                  type: object
                  properties:
                    reference:
                      type: array
                      items:
                        type: string
                        pattern: (VS|KS|SS):[0-9]{1,10}
                      minItems: 1
                      maxItems: 3
                      uniqueItems: true
                  required:
                    - reference
              required:
                - creditorReferenceInformation
            unstructured:
              $ref: '#/components/schemas/Max140Text'
        debtorNote:
          type: string
          description: zprava pro platce
        exchangeRate:
          type: number
          description: Smenny kurz
        individualExchangeRateFlag:
          type: boolean
          description: Priznak pro specialni kurz
      required:
        - operationId
        - sourceChannel
        - paymentIdentification
        - amount
        - debtorAccount
        - creditorAccount
    ValidateOKResponse:
      type: object
      properties:
        serviceLevel:
          $ref: '#/components/schemas/ServiceLevel'
        amount:
          type: object
          properties:
            debtorCcyAmount:
              description: Hodnota částky v měně odesílatele
              $ref: '#/components/schemas/ValueAndCurrency'
            creditorCcyAmount:
              description: Hodnota částky v měně příjemce
              $ref: '#/components/schemas/ValueAndCurrency'
          required:
            - debtorCcyAmount
            - creditorCcyAmount
        charges:
          type: object
          properties:
            accountCcyAmount:
              $ref: '#/components/schemas/ValueAndCurrency'
            instructionCcyAmount:
              $ref: '#/components/schemas/ValueAndCurrency'
            conversionAccountCcyAmount:
              $ref: '#/components/schemas/ValueAndCurrency'
        exchangeRate:
          type: number
          description: Kurz platby
      required:
        - serviceLevel
        - amount
    CreateOKResponse:
      type: object
      properties:
        businessChangeDate:
          $ref: '#/components/schemas/BusinessChangeDate'
        serviceLevel:
          $ref: '#/components/schemas/ServiceLevel'
        paymentIdentification:
          allOf:
            - $ref: '#/components/schemas/PaymentIdentification'
            - type: object
              properties:
                operationId:
                  $ref: '#/components/schemas/OperationId'
                PTSId:
                  $ref: '#/components/schemas/PTSId'
              required:
                - operationId
                - PTSId
      required:
        - businessChangeDate
        - serviceLevel
        - paymentIdentification
    OperationId:
      type: string
      description: Systémové ID platby
      minLength: 1
      maxLength: 20
      pattern: \S+.+
    PTSId:
      type: integer
      format: int64
      description: Unikatni PTS ID
    BusinessChangeDate:
      type: string
      format: date-time
      description: Datum business změny stavu datové entity
    ServiceLevel:
      type: string
      description: Typ platby
      enum:
        - DMCT
        - DICT
        - ESCT
        - EXCT
        - IBCT
        - NXCT
        - XBCT
    ValueAndCurrency:
      type: object
      properties:
        value:
          type: number
          description: Hodnota částky
          minimum: 0.01
          exclusiveMinimum: false
        currency:
          $ref: '#/components/schemas/Currency'
    Currency:
      type: string
      description: Kod meny podle ISO 4217 = 3 velka pismena
      pattern: '[A-Z]{3,3}'
    PaymentIdentification:
      type: object
      properties:
        instructionIdentification:
          type: string
          description: Unikátní ID platby
          minLength: 1
          maxLength: 35
        endToEndIdentification:
          $ref: '#/components/schemas/Max35Text'
      required:
        - instructionIdentification
    UltimateElement:
      allOf:
        - $ref: '#/components/schemas/NameAndAddress'
        - $ref: '#/components/schemas/UltimateIdentification'
    NameAndAddress:
      type: object
      description: Jmeno a adresa
      properties:
        name:
          $ref: '#/components/schemas/Max70Text'
        postalAddress:
          type: object
          description: adresa
          properties:
            streetName:
              $ref: '#/components/schemas/Max70Text'
            buildingNumber:
              $ref: '#/components/schemas/Max16Text'
            postCode:
              $ref: '#/components/schemas/Max16Text'
            townName:
              $ref: '#/components/schemas/Max35Text'
            country:
              $ref: '#/components/schemas/CountryCode'
            addressLine:
              $ref: '#/components/schemas/Max140Text'
    UltimateIdentification:
      type: object
      description: ''
      properties:
        identification:
          type: object
          description: ''
          oneOf:
            - type: object
              description: ''
              properties:
                organisationIdentification:
                  $ref: '#/components/schemas/OrganisationIdentification'
            - type: object
              description: ''
              properties:
                privateIdentification:
                  $ref: '#/components/schemas/PrivateIdentification'
    OrganisationIdentification:
      oneOf:
        - type: object
          description: ''
          properties:
            bicOrBei:
              $ref: '#/components/schemas/BIC'
        - $ref: '#/components/schemas/OtherIdentification'
    PrivateIdentification:
      oneOf:
        - type: object
          description: ''
          properties:
            dateAndPlaceOfBirth:
              type: object
              description: ''
              properties:
                birthDate:
                  type: string
                  format: date
                prvcOfBirth:
                  $ref: '#/components/schemas/Max35Text'
                cityOfBirth:
                  $ref: '#/components/schemas/Max35Text'
                countryOfBirth:
                  $ref: '#/components/schemas/CountryCode'
              required:
                - birthDate
                - cityOfBirth
                - countryOfBirth
        - $ref: '#/components/schemas/OtherIdentification'
    BIC:
      type: string
      description: BIC
      pattern: '[A-Z]{6,6}[A-Z2-9][A-NP-Z0-9]([A-Z0-9]{3,3}){0,1}'
    OtherIdentification:
      type: object
      description: ''
      properties:
        other:
          type: object
          description: ''
          properties:
            identification:
              $ref: '#/components/schemas/Max35Text'
            schemeName:
              oneOf:
                - type: object
                  properties:
                    code:
                      $ref: '#/components/schemas/Max4Text'
                  required:
                    - code
                - type: object
                  properties:
                    proprietary:
                      $ref: '#/components/schemas/Max35Text'
                  required:
                    - proprietary
            issuer:
              $ref: '#/components/schemas/Max35Text'
          required:
            - identification
      required:
        - other
    CountryCode:
      type: string
      description: Kod zeme
      pattern: '[A-Z]{2,2}'
    AccountElement:
      type: object
      description: ''
      properties:
        identification:
          $ref: '#/components/schemas/AccountIdentification'
        currency:
          $ref: '#/components/schemas/Currency'
    AccountIdentification:
      allOf:
        - anyOf:
            - type: object
              properties:
                iban:
                  type: string
                  description: IBAN
                  pattern: '[A-Z]{2,2}[0-9]{2,2}[a-zA-Z0-9]{1,30}'
              required:
                - iban
            - type: object
              description: Jina identifikace uctu
              properties:
                other:
                  type: object
                  properties:
                    identification:
                      type: string
                      description: Quaestor ID nebo cislo uctu
                      minLength: 1
                      maxLength: 34
                  required:
                    - identification
              required:
                - other
            - type: object
              properties:
                bban:
                  type: string
                  description: Cislo uctu v tuzemskem tvaru
                  pattern: '[0-9]{1,16}'
              required:
                - bban
        - type: object
          description: ''
          properties:
            bankcode:
              type: string
              description: CNB kod banky
              pattern: '[0-9]{4,4}'
    CreditorAgent:
      type: object
      description: ''
      properties:
        financialInstitutionIdentification:
          allOf:
            - type: object
              description: ''
              properties:
                bic:
                  $ref: '#/components/schemas/BIC'
                clearingSystemMemberIdentification:
                  type: object
                  description: ''
                  properties:
                    clearingSystemIdentification:
                      type: object
                      description: ''
                      properties:
                        code:
                          type: string
                          description: ''
                        proprietary:
                          type: string
                          description: ''
                    memberIdentification:
                      type: string
                      description: ''
            - $ref: '#/components/schemas/NameAndAddress'
      required:
        - financialInstitutionIdentification
    Max4Text:
      type: string
      minLength: 1
      maxLength: 4
      pattern: \S+.*
    Max16Text:
      type: string
      minLength: 1
      maxLength: 16
      pattern: \S+.*
    Max35Text:
      type: string
      minLength: 1
      maxLength: 35
      pattern: \S+.*
    Max70Text:
      type: string
      minLength: 1
      maxLength: 70
      pattern: \S+.*
    Max140Text:
      type: string
      minLength: 1
      maxLength: 140
      pattern: \S+.*
  responses:
    ValidateOK:
      description: Validace OK
      headers:
        X-Correlation-ID:
          $ref: '#/components/headers/X-Correlation-ID'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidateOKResponse'
    PaymentOK:
      description: OK
      headers:
        X-Correlation-ID:
          $ref: '#/components/headers/X-Correlation-ID'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreateOKResponse'
    PaymentStatusOK:
      description: OK
      headers:
        X-Correlation-ID:
          $ref: '#/components/headers/X-Correlation-ID'
      content:
        application/json:
          schema:
            type: object
            properties:
              businessState:
                type: string
                description: Business status platby
                enum:
                  - cancelled
                  - inProgress
                  - finished
                  - noStatus
                  - pendingFunds
                  - pendingMaturity
            required:
              - businessSate
    NoContent:
      description: OK
      headers:
        X-Correlation-ID:
          $ref: '#/components/headers/X-Correlation-ID'
    BadRequest:
      description: Syntaktická chyba requestu
      headers:
        X-Correlation-ID:
          $ref: '#/components/headers/X-Correlation-ID'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/BadRequestErrorModel'
    NotFound:
      description: Platba nenalezena pro dané PTS ID
      headers:
        X-Correlation-ID:
          $ref: '#/components/headers/X-Correlation-ID'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/NotFoundErrorModel'
    Forbidden:
      description: Platba není dostupná pro změny
      headers:
        X-Correlation-ID:
          $ref: '#/components/headers/X-Correlation-ID'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ForbiddenErrorModel'
    Conflict:
      description: Business validace neproběhla v pořádku
      headers:
        X-Correlation-ID:
          $ref: '#/components/headers/X-Correlation-ID'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ConflictErrorModel'
    InternalServerError:
      description: Chyba na serveru
      headers:
        X-Correlation-ID:
          $ref: '#/components/headers/X-Correlation-ID'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/InternalServerErrorModel'
