# Document Management - Summary

## Overview
Document Management capability provides comprehensive document lifecycle management including client documents, statements, and notices. This capability integrates with SHAREPOINT for client document storage, JTDOCS/XEROX for statement generation and processing, and BISQ for termination notices. The system supports document creation, updates, deletion, and reconciliation across multiple channels (CZ and SK).

## REST APIs

### ClientDocument - REST API (clientDocumentReconciliation)
- **Description:** Reconciliation API for client documents stored in SHAREPOINT. Exposed in WSO2 as part of digiClientOperations v2 API.
- **Key Operations:**
  - GET /clientDocument - Query all documents with optional filters
  - GET /clientDocument/{documentId} - Get specific document by ID
  - GET /health - Healthcheck endpoint
- **Data Objects:** ClientDocument entity with before/after states
- **Impacted Systems:** SHAREPOINT (source), WSO2 (gateway), DKCZ, DKSK

### API-documentStatementReconciliation
- **Description:** Reconciliation API for statement documents generated by JTDOCS/XEROX system. Separate endpoints for CZ and SK digital channels.
- **Key Operations:**
  - GET /statements - Query statements with filtering options
  - Supports single statement or bulk query by client/account
- **Data Objects:** Statement metadata
- **Impacted Systems:** JTDOCS, XEROX, WSO2, DKCZ, DKSK

### API-documentConfirmationReconciliation
- **Description:** Reconciliation API for confirmation documents. Separate endpoints for CZ and SK.
- **Key Operations:**
  - GET /statements/query - Query confirmations with various filters
  - Supports priority-based parameter handling
- **Data Objects:** Confirmation metadata
- **Impacted Systems:** JTDOCS, WSO2, DKCZ, DKSK

## Event Stream Topics

### ClientDocument - Event Stream
- **Purpose:** Publishes client document lifecycle events (create/update/delete) from SHAREPOINT
- **Event Types:**
  - Prob~ný (Continuous) - Real-time document changes
  - Inicializaní/Rekoncilianí (Init/Recon) - Bulk reconciliation
  - Kontrolní (Control) - Integration control
- **Data Objects:** ClientDocument with action states (create|update|delete)
- **Impacted Systems:**
  - **Publisher:** SHAREPOINT
  - **Consumer:** DKCZ, DKSK
  - **Topics:**
    - JTB-CZ_DOCUMENTS_CLIENT-DOCUMENT_EVENT_GNR (CZ continuous)
    - JTB-CZ_DOCUMENTS_CLIENT-DOCUMENT_RCN_GNR (CZ init/recon)
    - JTB-SK_DOCUMENTS_CLIENT-DOCUMENT_EVENT_GNR (SK continuous)
    - JTB-SK_DOCUMENTS_CLIENT-DOCUMENT_RCN_GNR (SK init/recon)
    - JTB-HQ_INTEGRATION_CONTROL_STREAM_GNR (Control)
  - **Frequency:** Tens to low hundreds of events daily

### Statement - Event Stream
- **Purpose:** Publishes bank statement metadata from JTDOCS/XEROX document generation system
- **Event Types:**
  - Prob~ný (Continuous via APP topics) - Real-time statement generation
  - Prob~ný (via GNR topics after KStreams) - Filtered streams per country
  - Inicializaní/Rekoncilianí - Bulk reconciliation
  - Kontrolní (Control) - Integration control
- **Data Objects:** Statement metadata (multiple statement types: BIS00-06, BIS10, OCP01-45)
- **Impacted Systems:**
  - **Publisher:** JTDOCS (from XEROX source)
  - **Consumer:** KStreams (filtering), DKCZ, DKSK
  - **Topics:**
    - JTB-HQ_DOCUMENTS_STATEMENT_SYNC_APP (HQ continuous)
    - JTB-CZ_DOCUMENTS_STATEMENT_STREAM_GNR (CZ filtered)
    - JTB-HQ_DOCUMENTS_STATEMENT_RSYNC_APP (HQ init/recon)
    - JTB-CZ_DOCUMENTS_STATEMENT_RCN_GNR (CZ init/recon)
    - JTB-SK_DOCUMENTS_STATEMENT_STREAM_GNR (SK filtered)
    - JTB-SK_DOCUMENTS_STATEMENT_RCN_GNR (SK init/recon)
    - JTB-HQ_INTEGRATION_CONTROL_STREAM_GNR (Control)
  - **Frequency:** Average 11 documents per minute

### Notices - Event Stream
- **Purpose:** Publishes deposit termination notice events from BISQ system
- **Event Types:**
  - Prob~ný (Continuous) - Real-time termination notices
  - Inicializaní/Rekoncilianí - Bulk reconciliation
  - Kontrolní (Control) - Integration control
- **Data Objects:** Notices (termination data)
- **Impacted Systems:**
  - **Publisher:** BISQ
  - **Consumer:** DKCZ, DKSK
  - **Topics:**
    - JTB-CZ_DEPOSITS_NOTICES_EVENT_GNR (CZ continuous)
    - JTB-CZ_DEPOSITS_NOTICES_RCN_GNR (CZ init/recon)
    - JTB-SK_DEPOSITS_NOTICES_EVENT_GNR (SK continuous)
    - JTB-SK_DEPOSITS_NOTICES_RCN_GNR (SK init/recon)
    - JTB-HQ_INTEGRATION_CONTROL_STREAM_GNR (Control)
  - **Frequency:** Hundreds of events daily

## Data Objects

### ClientDocument
**Description:** Represents client documents stored in SHAREPOINT with full lifecycle tracking

**Key Attributes:**
- **X-Correlation-ID** (string, 0..1): Correlation ID for tracking
- **action** (string, ENUM, 1): Operation type (create|update|delete) - BUSINESS_STATE
- **timestamp** (string, datetime, 1): Operation timestamp (UTC) - BCD
- **documentId** (string, 1): Unique document ID for CRM DIGI API (BID, KEY)
- **entity** (object, 1): Entity to which document belongs
  - **id** (uuid, 1): Entity ID (min/max length: 36)
  - **type** (string, 1): Entity type
- **parent** (object, 1): Parent entity information
  - **id** (string, 1): Parent entity ID (usually client ID)
  - **type** (string, ENUM, 1): Parent type (account|contact)
- **before** (object, 0..1): Document state before change
  - **fileName** (string, 1): Document file name
  - **fileSize** (integer, 1): File size in bytes
  - **category** (string, 1): Folder in SharePoint tree
  - **operation** (object, 0..1): Operation code and name
  - **ironMountain** (object, 0..1): Iron Mountain archival data (barCodeBox, status)
  - **comment** (string, 0..1): Document comment
- **after** (object, 1): Document state after change (same structure as before)

**Business Identifiers:**
- BID: documentId
- KEY: documentId
- BUSINESS_STATE: action (create|update|delete)
- BCD: timestamp

**Integration Details:**
- Triggered by: Create/update/delete in SHAREPOINT (most calls from CRM)
- Reconciliation params: parentId + type, businessChangeDateStart/End, or documentId

### Statement
**Description:** Bank statement metadata from JTDOCS/XEROX system supporting multiple statement types

**Key Attributes:**
- **KEY**: documentId (statement identifier)
- **BUSINESS_CHANGE_DATE**: Date of entity change
- **BODY**: JSON message body (CLOB) containing full statement entity
- **LOCATION**: Country code (CZ|SK)
- **CREATED**: Timestamp when inserted (UTC)
- **ENTITY_TYPE**: Fixed value "Statement"
- **UPDATED**: Last update timestamp (UTC)
- **X_CORRELATION_ID**: Correlation ID for init/recon (in init/recon table only)

**Statement Types Supported:**
- BIS00-06: Current account, term deposit, savings, card account statements
- BIS10: Fee statement
- OCP01, OCP03: Asset status and movement information (IU, TU)
- OCP32-33: Investment and asset account statements
- OCP39: Yields
- OCP41-42: Cost and incentive overview
- OCP45: Unsettled derivatives information

**Technical Implementation:**
- Interface tables: DOCUMENTS_STATEMENT_CONTINUOUS, DOCUMENTS_STATEMENT_INIT_AND_RECON
- DB procedure populates interface tables from JTDOC
- Kafka JDBC connector reads from interface tables
- State monitoring: DOCUMENT_PROCESSING_STATUS_ID (states 2, 5, 7 trigger events)

**Processing States (XEROX):**
1. New
2. InsertedForXerox
3. GettingDataFromDb
4. Generating_XML
5. XML_Generated
6. Formatting
7. PDF_Generated
8. SendingToSharePoint
9. Completed
10. Error
11. Suspended
12. Temp

**Business Identifiers:**
- BID: statementId
- KEY: statementId
- BCD: BUSINESS_CHANGE_DATE

**Reconciliation Parameters:**
- statementId (single statement) or
- crmid, quaestorId, topasId, statementTypeCodeId with businessChangeDateStart/End

### Notices
**Description:** Deposit termination notices from BISQ system

**Key Attributes:**
- **terminationId**: Termination identifier (BID)
- **state**: Termination state (BUSINESS_STATE)
  - A = Authorized (internal state before account opening)
  - O = Open
  - C = Closed
- **EVENT_TIMESTAMP**: New attribute for BCD (timestamp when event inserted)
- Various termination details (to be found in data model documentation)

**Business Identifiers:**
- BID: terminationId
- BUSINESS_STATE: state (A|O|C)
- BCD: EVENT_TIMESTAMP

**Reconciliation:** GET /api/reconciliation/notice via quaestorReconciliationSk service

## Integration Points

### Publishing Systems

#### SHAREPOINT
- **Publishes:** ClientDocument events
- **Trigger:** Create/update/delete operations on documents (mostly via CRM API calls)
- **Frequency:** Tens to low hundreds daily
- **Destinations:** DKCZ (CZ), DKSK (SK) via both continuous and recon topics

#### JTDOCS (from XEROX)
- **Publishes:** Statement metadata
- **Trigger:** State changes in document processing (status 2, 5, 7 in EPO_DOCUMENTS)
- **Frequency:** Average 11 documents/minute, ~11,615 statements over 8.5 months (Jan-Sep 2022)
- **Destinations:** KStreams for filtering, then DKCZ (CZ), DKSK (SK)
- **Architecture:** DB procedures ’ Interface tables ’ Kafka JDBC connector ’ Topics

#### BISQ
- **Publishes:** Notices (deposit termination events)
- **Trigger:** Creation or update of termination notices
- **Frequency:** Hundreds of events daily
- **Destinations:** DKCZ (CZ), DKSK (SK) via continuous and recon topics
- **Note:** All events published (no filtering)

### Consuming Systems

#### DKCZ (Czech Digital Channel / Data Warehouse)
- **Consumes:** All document types (ClientDocument, Statement, Notices)
- **Purpose:** Data warehousing and analytics for Czech operations
- **Topics:** All CZ-specific continuous, init/recon, and control topics

#### DKSK (Slovak Digital Channel / Data Warehouse)
- **Consumes:** All document types (ClientDocument, Statement, Notices)
- **Purpose:** Data warehousing and analytics for Slovak operations
- **Topics:** All SK-specific continuous, init/recon, and control topics

#### KStreams
- **Consumes:** Statement HQ APP topics
- **Purpose:** Filtering and routing statements by country (CZ/SK)
- **Produces:** Country-specific GNR topics for downstream consumption

#### CRM
- **Role:** Primary caller of SHAREPOINT API for document operations
- **Purpose:** Client relationship management and document association

### Integration Patterns

**ClientDocument Reconciliation:**
- Method: GET /clientDocument or GET /clientDocument/{documentId}
- Header params (required): X-Correlation-ID, traceparent
- Query params (optional): parentId + parentType, businessChangeDateStart/End, documentId
- Rules:
  - If parentId provided, parentType must also be provided
  - If businessChangeDateStart not provided, defaults to 90 days back
- Initialization: Returns all available client document states from SHAREPOINT history

**Statement Reconciliation:**
- Method: GET /statements
- Header params (required): X-Correlation-ID, traceparent
- Query params (required): locations
- Query params (optional): statementId, crmid, quaestorId, topasId, statementTypeCodeId, businessChangeDateStart/End
- Priority order: statementId > crmid > quaestorId > topasId > statementTypeCodeId
- If no businessChangeDateStart/End provided, defaults to current time - 90 days
- Initialization: Sends statement metadata for download

**Confirmation Reconciliation:**
- Method: GET /statements/query
- Similar parameter structure to statement reconciliation
- Priority order: confirmationId > crmid > confirmationTypeId > taId > topasId
- Bad Request (400) if no optional parameters provided

**Document Download:**
- POST /Document/download/statement/metadata - Download statement metadata
- POST /Document/download/statement - Download statement file(s), returns ZIP for multiple
- Functionality in digiClientOperations v2.1 API

## Summary Statistics

- **Total REST APIs:** 3
  - ClientDocument Reconciliation API
  - Statement Reconciliation API
  - Confirmation Reconciliation API
- **Total Event Streams:** 3 (ClientDocument, Statement, Notices)
- **Total Active Topics:** 15
  - ClientDocument: 5 topics (2 CZ + 2 SK + 1 control)
  - Statement: 7 topics (1 HQ APP + 1 CZ GNR + 1 HQ RSYNC + 1 CZ RCN + 1 SK GNR + 1 SK RCN + 1 control)
  - Notices: 5 topics (2 CZ + 2 SK + 1 control)
  - Note: Control topic (JTB-HQ_INTEGRATION_CONTROL_STREAM_GNR) is shared
- **Total Data Objects:** 3 (ClientDocument, Statement, Notices)
- **Total Impacted Systems:** 8
  - Publishers: SHAREPOINT, JTDOCS, XEROX, BISQ
  - Middleware: KStreams, WSO2
  - Consumers: DKCZ, DKSK
  - Integration: CRM (API caller)

## Technical Configuration

### Kafka Configuration
- Partitions: 8 (general), 1 (for codebooks)
- Replicas: 3
- Replication period: 6 days

### Error Handling
- ClientDocument: Not fully resolved (marked as TBD)
- Statement: Described in eBroker/CCP event processing page
- Notices: Not fully resolved (marked as TBD)

### Capacity Requirements

**ClientDocument:**
- Volume: Tens to low hundreds of documents daily (TBD from ACMARK)
- Size: TBD

**Statement:**
- Volume: Average 11 documents per minute
- Historical data: 11,615 statements from Jan 1 - Sep 16, 2022
- Continuous processing with no max error limit (runs until error fixed)

**Notices:**
- Volume: Hundreds of events daily
- All states published (no filtering)

### Data Quality Notes
- SHAREPOINT events include before/after states for complete audit trail
- Statement processing monitored through 12 distinct states
- Correlation IDs required for initialization and reconciliation
- All timestamps in UTC format
- Business Change Date requires second-level precision minimum
