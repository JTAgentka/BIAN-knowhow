# Advisory Services - Summary

## Overview
Advisory Services capability manages real-time data access permissions and questionnaires for investment market trading platforms. The system controls customer access to real-time market data from various stock exchanges (e.g., NYSE, NASDAQ, LSE, XETRA), handling both the questionnaire completion process and the resulting access permissions. This capability ensures compliance with exchange requirements and manages customer eligibility for real-time data subscriptions.

## REST APIs

### RealTimeDataAccess Reconciliation
- **Description:** Reconciliation API for real-time data access settings and questionnaires, exposed on WSO2 platform
- **Key Operations:**
  - GET /realTimeDataAccess - Retrieve all real-time data access settings with optional filters
  - GET /realTimeDataAccess/{applicationId} - Retrieve specific application/form instance
  - GET /health - Health check endpoint
- **Data Objects:** RealTimeDataAccess (ClientRealTimeDataAccess)
- **Impacted Systems:** CRM (source), DKCZ (target), DKSK (target), WSO2 (API gateway)

## Event Stream Topics

### JTB-CZ_PARTIES_REAL-TIME-DATA-ACCESS_SYNC_GNR
- **Purpose:** Continuous streaming of real-time data access changes for Czech market
- **Event Types:** Access grants, revocations, questionnaire completions
- **Data Objects:** RealTimeDataAccess entity
- **Impacted Systems:**
  - Publishers: CRM
  - Subscribers: DKCZ

### JTB-CZ_PARTIES_REAL-TIME-DATA-ACCESS_RCN_GNR
- **Purpose:** Reconciliation of real-time data access settings for Czech market
- **Event Types:** Bulk reconciliation events
- **Data Objects:** RealTimeDataAccess entity
- **Impacted Systems:**
  - Publishers: CRM
  - Subscribers: DKCZ

### JTB-SK_PARTIES_REAL-TIME-DATA-ACCESS_SYNC_GNR
- **Purpose:** Continuous streaming of real-time data access changes for Slovak market
- **Event Types:** Access grants, revocations, questionnaire completions
- **Data Objects:** RealTimeDataAccess entity
- **Impacted Systems:**
  - Publishers: CRM
  - Subscribers: DKSK

### JTB-SK_PARTIES_REAL-TIME-DATA-ACCESS_RCN_GNR
- **Purpose:** Reconciliation of real-time data access settings for Slovak market
- **Event Types:** Bulk reconciliation events
- **Data Objects:** RealTimeDataAccess entity
- **Impacted Systems:**
  - Publishers: CRM
  - Subscribers: DKSK

### JTB-HQ_INTEGRATION_CONTROL_STREAM_GNR
- **Purpose:** Integration control and monitoring
- **Event Types:** Control messages
- **Data Objects:** Control stream metadata
- **Impacted Systems:**
  - Publishers: CRM
  - Subscribers: DKCZ, DKSK

## Data Objects

### RealTimeDataAccess
Entity managing customer access to real-time market data from stock exchanges, including completed questionnaires and access evaluation results.

**Key Attributes:**

**Header:**
- **X-Correlation-ID** (string, optional): Correlation identifier for INIT and RECON

**Client Real-Time Data (clientRealTimeData):**
- **owner** (object, required): Client identifiers
  - **crmId** (string, required): Client CRM identifier (KLID), length 10
- **degreeBeforeId** (string): Title before name (individual only)
- **surname** (string): Surname (individual only)
- **firstname** (string): First name (individual only)
- **degreeAfterId** (string): Title after name (individual only)
- **businessName** (string): Business name (corporate only)
- **rtDataAccess** (boolean, required): Whether client has RT data enabled (true/false)
- **rtDataAccessChangeWhen** (string, date-time, required): Date/time when rtDataAccess attribute changed
- **previousRtDataAccess** (boolean, required): Previous value of rtDataAccess (for reporting purposes)

**Application Data (applicationData):**
- **applicationIds** (object, required): Application identifiers
  - **crmApplicationId** (string, uuid, required): Form instance ID in CRM
  - **camundaId** (string, uuid): Business process instance ID if manual workflow
- **formVersion** (string): Version of form completed by client
- **isClientRequest** (boolean, required): Whether event generated by client request (true) or CRM setting (false)
- **filledBy** (object, required): Person who filled questionnaire
  - **crmId** (string, required): CRM identifier of person, length 10
- **filledWhen** (string, date-time, required): Date/time form submitted (Business Change Date)
- **autoEval** (boolean, required): Whether access automatically evaluated
- **manualEvalBy** (string): Domain name of backoffice operator (JTXXX format)
- **processEndWhen** (string, date-time, required): Date/time of evaluation in Camunda

**Market Data (market):**
- **marketFormId** (string, required): Exchange questionnaire identifier
- **language** (string, required): Questionnaire language (ISO 639-1 alpha2 code)
- **questionnaireItems** (array, optional): Questionnaire items for exchange
  - **items** (array): Collection of questionnaire items
    - **questionKey** (string, required): Question code
    - **questionAnswer** (string, required): Answer to question

**Business Identifiers:**
- Business Identifier: owner.crmId
- Business Change Date: filledWhen
- Partition Key: owner.crmId

**Referenced Code Tables:**
- **InvExchanges > Function 4**: Stock exchanges providing real-time data
- **RTDataForms > Function 3**: Languages available for questionnaires
- **RTDataForms > Key 1**: Unique questionnaire identifier
- **RTDataQuestions > Description**: Question codes for exchange questionnaires
- **Languages > alpha2**: ISO 639-1 language codes

## Integration Points

### Publishing Systems
- **CRM**: Publishes real-time data access changes when questionnaires are completed or settings are modified by operators

### Consuming Systems
- **DKCZ (Digital Channels CZ)**: Consumes access settings to control real-time data availability in trading applications
- **DKSK (Digital Channels SK)**: Consumes access settings to control real-time data availability in trading applications

## Technical Implementation

### Event Characteristics
- **Trigger:** Questionnaire completion, manual access grant/revocation in CRM, or workflow completion in Camunda
- **Frequency:** Not specified in documentation
- **Note:** Valid record may not contain any form (e.g., BCPP or direct CRM intervention)

### API Parameters

**Reconciliation:**
- Headers: X-Correlation-ID, traceparent
- Path params: applicationId (form instance in CRM)
- Query params (optional):
  - accountId (AccountGUID): Account number
  - klientId (AccountKLID): Client number
  - filledWhenFrom: Date range start (BCD filtering)
  - filledWhenTo: Date range end (BCD filtering)
  - marketFormId: Stock exchange for which questionnaire was filled

### Special Cases
- **Client Request vs. CRM Setting:** System tracks whether change originated from client action or operator decision
- **Automatic vs. Manual Evaluation:** Process can be fully automated or require manual approval
- **Multiple Exchanges:** Single client can have different access settings for different stock exchanges
- **Form Versions:** System tracks questionnaire version to handle changes in exchange requirements
- **BCPP Exception:** Valid records without questionnaires (Prague Stock Exchange or direct CRM actions)
- **Reporting Optimization:** Previous value tracked to avoid redundant reporting (e.g., multiple "enabled" events)

### Error Handling
- Duplicates may occur up to BCD level
- Consumers must implement deduplication logic
- Standard integration aspects apply

## Summary Statistics
- **Total REST APIs:** 1 (RealTimeDataAccess Reconciliation)
- **Total Event Streams:** 5 (4 RealTime Data Access topics - 2 CZ + 2 SK, 1 Control)
- **Total Data Objects:** 1 (RealTimeDataAccess)
- **Total Impacted Systems:** 5 (CRM, DKCZ, DKSK, WSO2, Camunda)
- **Total Referenced Code Tables:** 4 (InvExchanges, RTDataForms, RTDataQuestions, Languages)

## Special Notes
- Supports both client-initiated and operator-initiated access changes
- Integrates with Camunda workflow engine for manual approval processes
- Tracks form versions to accommodate changing exchange requirements
- Maintains access history through previous value tracking
- Allows CRM overrides without questionnaire completion
- Initialization sends all real-time data access settings currently active
- JSON schemas stored in centralized repository
- Different questionnaires for different stock exchanges
- Language-specific questionnaire support
